#!/bin/bash

source /usr/local/bin/devops-func.sh
MODE="write"

number_of_arguments=$#

if [ $number_of_arguments -lt 2 ]; then
    echo "ERROR: Invalid number of arguments"
    echo "Usage:   sudo devops-mv <file_path1> <file_path2>"
    echo "Example: sudo devops-mv /etc/test.txt /etc/test2.txt"
    exit 1
fi

if [ $number_of_arguments -eq 2 ]; then
    file_path1="$1"
    file_path2="$2"
fi
if [ $number_of_arguments -eq 3 ]; then
    argument="$1" # -r, -rf, -f
    file_path1="$2" # file path
    file_path2="$3" # file path
    shift
fi

if [ $number_of_arguments -eq 3 ]; then
    allowed_parameters=0
    if [ "$argument" == "-r" ] || [ "$argument" == "-rf" ] || [ "$argument" == "-f" ]; then
        allowed_parameters=1
    fi
    if [ $allowed_parameters -eq 0 ]; then
        echo "ERROR: First argument must be: -r, -rf, or -f"
        exit 1
    fi
fi

startup_checks "$MODE" "$file_path1"
is_allowed_path_for_mode "$MODE" "$file_path1"

startup_checks "$MODE" "$file_path2"
is_allowed_path_for_mode "$MODE" "$file_path2"

if [ $number_of_arguments -eq 2 ]; then
    /usr/bin/mv "$file_path1" "$file_path2"
elif [ $number_of_arguments -eq 3 ]; then
    /usr/bin/mv $argument "$file_path1" "$file_path2"
fi

exit $?
